<html>
  <head>
    <script lang="javascript" src="js/jquery-3.1.0.min.js"></script>
    <script lang="javascript" src="js/d3.v4.min.js"></script>
    <script src="js/plotly.js"></script>
  </head>
  <body>
    <!-- <div id="tester" style="width:600px;height:250px;"></div> -->
    <svg width=100% height=100%></svg>    
    <script>            

      var short_labels = ['ABC','BBC','BBN','BI','BZFD','CBC','CBS','CNBC','CNN','FT','FOX','MSNBC','NBC','POL','ECON','HUFF','NYT','WSJ','WASH','USA']
            
      var width = $(window).width();
      var height = $(window).height();
      
      var svg = d3.select("svg")
	  .attr('width','100%')
	  .attr('height','100%');
      
      var background = svg.append('rect')
	  .attr("width",'100%')
	  .attr('height','100%')
	  .attr('fill','#E1F5FE');
      
      var g = svg.append('g');

      var graph = d3.select('body').append('div')
	  .attr('id','graph')
	  .attr('width',width*.25)
      	  .attr('height',height*.1)
	  .style('position','absolute')
	  .style('top',function() { return 0; })
	  .style('left',function() { return width/4; })	  
      
      var data;     
      d3.json('dataset.json',function(dataset){
	  data = dataset;
	  var x_offset = width/20; //250;
	  g.selectAll(".polarized-source-text")
	      .data(data["Donald Trump"].total_info)
	      .enter()
	      .append('text')
	      .attr("class","polarized-source-text")

	      .attr('x', function(d, i) {
		  return x_offset + i * 50;
	      })
	      .attr('y', height * .5)
	      .text(function(d,i) {
		  return short_labels[i];//d.source.source_id;
	      })
	      .style('fill',function(d,i) {
		  if (i==0) return 'green';
		  else return 'black';
	      })
	      .style('text-anchor','middle')
	      .on('mouseover', function(d){
		  d3.select(this).style('cursor','pointer');
	      })
	      .on('click', function(d,i) {
		  graph_news_org(i);
		  color_polarized_text(i);		 
	      });
	  graph_news_org(0);
      });

      function color_polarized_text(y){
	  d3.selectAll(".polarized-source-text")
	      .data(data["Donald Trump"].total_info)
	      .transition().style('fill',function(d,i){		 
		  if (i==y) { console.log("same!"); return 'green'; }
		  else { console.log('different'); return 'black'; }
		  ;});	  
      }
      
      function graph_news_org(news_org_loc){

	  var y=[];
	  d3.json('dataset_with_time.json',function(dataset){
	      data=dataset	     
	      for (var day in data['Donald Trump'].date_info){     	      
		  y.push(data['Donald Trump'].date_info[day]['daily_info'][news_org_loc]); //0th index is abc news
	      }
	      
	      var y_neg=[];
	      var y_pos=[];
	      var y_neu=[];
              
	      for (var day in y){
		  y_neg.push(y[day]['negative'].count * y[day]['negative'].sentiment);
		  y_pos.push(y[day]['positive'].count * y[day]['positive'].sentiment);
		  y_neu.push(y[day]['neutral'].count * y[day]['neutral'].sentiment);
	      }
              
	      var x = [14,15,16,17,18,19,20,21,22]
	      
	      TESTER = document.getElementById('graph');
	      Plotly.purge(TESTER);
	      Plotly.plot( TESTER, [{
		  x: x,
		  y: y_neg,}], {title: short_labels[news_org_loc] + ' news over the week for Trump'})
	      	      
	  });
      };
     
      </script>
  </body>
</html>
