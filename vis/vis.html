<!DOCTYPE html>
<html>
    <head>
	<script src="js/env.js"></script>
	<script lang="javascript" src="js/jquery-3.1.0.min.js"></script>
	<script lang="javascript" src="js/d3.v4.min.js"></script>
	<script lang="javascript" src="js/data.js"></script>
	<script type="text/application/javascript/json" src="js/jquery.ajax-cross-origin.min.js"></script>
	<link rel="stylesheet" href="css/styles.css">
    </head>
  <body>
    <svg width=100% height=100%></svg>
    <script>

     var width = $(window).width();
     var height = $(window).height();
     
     var svg = d3.select("svg")
		 .attr('width','100%')
		 .attr('height','100%');
     
     var background = svg.append('rect')
			 .attr("width",'100%')
			 .attr('height','100%')
			 .attr('fill','black');
     
     var g = svg.append('g');
     
     //credit http://samherbert.net/svg-loaders/ for the startup image
     var im = g.append('svg:image')
	       .attr('xlink:href','js/svg_loading/svg-loaders/circles.svg')
	       .attr('x','50%')
	       .attr('y','50%')
	       .attr('width',200)
	       .attr('height',200);
     
     
     var d = call_ajax('Donald Trump')
     
     var people=['Donald Trump','Jamal Khashoggi','Lettuce'];


     
     /* d3.select('g').selectAll('text')
	.data(people)
	.enter()
	.append('text')
      	.attr('x',function(d,i){ return i*250+250; })
	.attr('y',height/2.0+150)
	.text(function(d) { return d; })
	.style('fill','white')
	.style('text-anchor','middle')
	.style('visibility','hidden')
	.on('mouseover',function(d){
	d3.select(this).style('cursor','pointer');
	})
	.on('click',function(d){
	d3.selectAll('circle').remove(); //remove so we don't bloat
	d3.selectAll('text').remove();
	im.style('visibility','visible'); //should disable rendering
	call_ajax(d);	    
	}); */

     function create_people_text(){
	 var people_text = d3.select('g').selectAll('text')
			     .data(people)
			     .enter()
			     .append('text')
      			     .attr('x',function(d,i){ return i*250+250; })
			     .attr('y',height/2.0+150)
			     .text(function(d) { return d; })
			     .style('fill','white')
			     .style('text-anchor','middle')
			     .style('visibility','visible')
			     .on('mouseover',function(d){
				 d3.select(this).style('cursor','pointer');
			     })
			     .on('click',function(d){
				 d3.selectAll('circle').remove(); //remove so we don't bloat
				 d3.selectAll('text').style('visibility','hidden');
				 im.style('visibility','visible'); //should disable rendering
				 call_ajax(d);				 
				 d3.selectAll('text').style('visibility','visible');
			     });
	 return people_text;

     }
     
     var people_text = create_people_text();
     
     function call_ajax(query){
	 $.ajax({
	     crossOrigin: true,
	     url: env.ngrok_ip + '/get_saved',
	     type: "POST",
	     data: 'name='+query,				
	     success: function(returned_data) {		 
		 json_data = JSON.parse(returned_data);	
		 im.style('visibility','hidden'); //should disable rendering		  
		 var x_offset=25;
		 
		 for (entity in json_data) {		    
		     var entity_data = json_data[entity];		   
		     var sorted_keys = Object.keys(entity_data).sort();		    
		     
		     for (i=0;i<sorted_keys.length;i++){
			 var x_loc = x_offset + i * 50;
			 g.append('rect')
			  .attr("height", function(d) { return entity_data[sorted_keys[i]]['positive'] * 100; } )
			  .attr('width',20)
			  .attr("x", x_loc - 10)
			  .attr("y", height / 2.0 - 30 - entity_data[sorted_keys[i]]['positive'] * 100)
			  .style("fill","green")
			  .style('visibility','visible');			 		

			 g.append('rect')
			  .attr("height", function(d) { return entity_data[sorted_keys[i]]['negative'] * 100 * -1; } )
			  .attr('width',20)
			  .attr("x", x_loc - 10)
			  .attr("y", height / 2.0 + 20)
			  .style("fill","red")
			  .style('visibility','visible');			 		
			 
			 g.append('text')
			  .attr('x', x_loc)
			  .attr('y', height/2.0)
			  .text(sorted_keys[i])
			  .style('fill','white')
			  .style('text-anchor','middle')
			  .style('visibility','visible');

		     }
		     break;
		 }	
	     }
	 });
     };
    </script>    
  </body>
</html>

 <!-- <div -- </div>>>
